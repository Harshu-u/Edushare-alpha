{% extends "core/base.html" %}

{% block title %}Category Management{% endblock %}

{% block page_title %}Category Management{% endblock %}

{% block content %}

<div class="bg-card p-6 rounded-2xl shadow-lg border border-border mb-6 animate-fade-in-up">
  <div class="flex flex-col md:flex-row justify-between items-center gap-4">
    <div>
      <h3 class="text-lg font-semibold">All Categories</h3>
      <p class="text-sm text-muted-foreground">Add, edit, or delete note categories.</p>
    </div>
    {% if user.is_teacher or user.is_staff %}
    <div class="flex gap-3">
      <a 
        href="{% url 'categories:category-create' %}" 
        class="btn-primary flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium"
      >
        <i data-lucide="plus" class="w-4 h-4"></i>
        Add Category
      </a>
    </div>
    {% endif %}
  </div>
</div>

<div class="bg-card rounded-2xl shadow-lg border border-border overflow-hidden animate-fade-in-up" style="animation-delay: 200ms;">
  <div class="overflow-x-auto">
    <table class="w-full min-w-max text-sm text-left">
      <thead class="bg-muted border-b border-border">
        <tr>
          <th class="p-4 font-medium text-muted-foreground">Category Name</th>
          <th class="p-4 font-medium text-muted-foreground">Parent Category</th>
          <th class="p-4 font-medium text-muted-foreground">Note Count</th>
          {% if user.is_teacher or user.is_staff %}
          <th class="p-4 font-medium text-muted-foreground text-right">Actions</th>
          {% endif %}
        </tr>
      </thead>
      <tbody class="divide-y divide-border">
        {% for category in categories %}
        <tr class="table-row stagger-table-row">
          <td class="p-4 font-medium text-foreground">
            <a href="{% url 'categories:category-detail' category.pk %}" class="hover:underline hover:text-primary">{{ category.name }}</a>
          </td>
          <td class="p-4 text-muted-foreground">{{ category.parent.name|default:"N/A" }}</td>
          <td class="p-4 text-muted-foreground">{{ category.note_count }}</td>
          
          {% if user.is_teacher or user.is_staff %}
          <td class="p-4 flex justify-end gap-2">
            <a href="{% url 'categories:category-edit' category.id %}" class="p-2 rounded-lg text-muted-foreground transition-all hover:bg-muted hover:text-primary hover:scale-110"><i data-lucide="edit" class="w-4 h-4"></i></a>
            
            <form method="POST" action="{% url 'categories:category-delete' category.id %}">
              {% csrf_token %}
              <button 
                type="submit" 
                onclick="return confirm('Are you sure you want to delete this category? This cannot be undone.');" 
                class="p-2 rounded-lg text-muted-foreground transition-all hover:bg-muted hover:text-destructive hover:scale-110">
                <i data-lucide="trash-2" class="w-4 h-4"></i>
              </button>
            </form>
          </td>
          {% endif %}
        </tr>
        {% empty %}
        <tr class="table-row">
            <td colspan="4" class="p-4 text-center text-muted-foreground">No categories found. Use the button above to add one!</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <div class="p-4 border-t border-border flex items-center justify-between">
    <p class="text-sm text-muted-foreground">Showing <strong>{{ categories|length }}</strong> results</p>
  </div>
</div>

{% endblock %}