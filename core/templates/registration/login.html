{% load static %}
<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - EduShare</title>
    
    <link href="{% static 'css/output.css' %}" rel="stylesheet" />
    
    <script src="https://unpkg.com/lucide@latest"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    </head>
<body class="auth-page text-foreground flex items-center justify-center min-h-screen p-4">

    <div class="aurora-bg"></div>

    <div class="w-full max-w-md p-8 md:p-10 rounded-2xl glass-card animate-fade-in-up">
        
        <div class="text-center mb-8">
             <div class="w-14 h-14 btn-primary rounded-2xl flex items-center justify-center text-primary-foreground font-bold text-2xl mx-auto mb-5 shadow-lg">
                ES
             </div>
            <h1 class="text-3xl font-bold text-foreground">Welcome Back!</h1>
            <p class="text-muted-foreground text-sm mt-2">Share Notes. Get Better Grades.</p>
        </div>

        {# Display messages from other pages (like register) #}
        {% if messages %}
            {% for message in messages %}
                <div class="bg-blue-100 border border-blue-300 text-blue-800 p-3 rounded-lg mb-6 text-sm" x-data="{ show: true }" x-show="show" x-init="setTimeout(() => show = false, 5000)" x-transition>
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}

        {# Display errors if login fails #}
        {% if form.errors %}
            <div class="bg-destructive/10 border border-destructive text-destructive p-3 rounded-lg mb-6 text-sm">
                Your username and password didn't match. Please try again.
            </div>
        {% endif %}

        {% if next and not user.is_authenticated %}
             <div class="bg-muted border border-border text-muted-foreground p-3 rounded-lg mb-6 text-sm">
                Please login to see this page.
             </div>
        {% endif %}

        <form method="post" action="{% url 'login' %}">
            {% csrf_token %} {# IMPORTANT security tag #}
            
            <div class="space-y-5">
                <div class="relative">
                    <label for="id_username" class="absolute -top-2.5 left-3 px-1 bg-card text-xs font-medium text-muted-foreground">Username</label>
                    <input 
                        type="text" 
                        name="username" 
                        autofocus autocapitalize="none" 
                        autocomplete="username" 
                        maxlength="150" 
                        required 
                        id="id_username"
                        class="form-input"
                        placeholder="Enter your username"
                    >
                </div>
                <div class="relative">
                    <label for="id_password" class="absolute -top-2.5 left-3 px-1 bg-card text-xs font-medium text-muted-foreground">Password</label>
                    <input 
                        type="password" 
                        name="password" 
                        autocomplete="current-password" 
                        required 
                        id="id_password"
                        class="form-input"
                        placeholder="Enter your password"
                    >
                </div>
            </div>

            <button 
                type="submit" 
                class="btn-primary w-full px-4 py-2.5 rounded-lg text-sm font-semibold mt-8 tracking-wide"
            > Login
            </button>
             <input type="hidden" name="next" value="{{ next }}">
        </form>
        
        <p class="text-center text-sm text-muted-foreground mt-8">
            Don't have an account? 
            <a href="{% url 'register' %}" class="font-semibold text-primary hover:text-primary-dark hover:underline">
                Sign up
            </a>
        </p>

        <div class="relative flex items-center justify-center my-6">
          <div class="absolute inset-0 flex items-center">
            <span class="w-full border-t border-border/50"></span>
          </div>
          <span class="relative px-2 text-xs text-muted-foreground bg-card">OR</span>
        </div>
        <a href="{% url 'notes:note-list' %}" class="block w-full text-center text-sm font-semibold text-primary hover:text-primary-dark hover:underline">
          Continue as a Guest
        </a>
        </div>
    
    <script>
        lucide.createIcons();
    </script>

</body>
</html>